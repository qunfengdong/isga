<%args> #! -*- cperl -*-
 $pipeline_builder
 $cluster => undef
</%args>
<%perl>
if(defined $cluster){
  $pipeline_builder->update($cluster);
  sleep(1);
}
</%perl>
<& /PipelineBuilder/edit_workflow.mas, pipeline_builder => $pipeline_builder &>

<sys:script type="text/javascript" src="/include/js/jtip.js"></sys:script>
<sys:script type="text/javascript" src="/include/js/jquery.livequery.js"></sys:script>
<sys:script type="text/javascript" src="/include/js/popup_wrapper.js"></sys:script>
<sys:style type="text/css" media="screen">
  @import "/include/css/jtip.css";
</sys:style>
<sys:style type="text/css" media="screen">
  @import "/include/css/uni-form.css";
</sys:style>



<style> @import "/include/css/uni-form.css";    </style>
<sys:script type="text/javascript">
  function processComponents(cluster) {
    $.ajax({
      url: "/PipelineBuilder/ChooseComponent?pipeline_builder=<% $pipeline_builder %>&cluster="+cluster,
      success: function(html){
        $('#modal_content').append(html); 
      }
    });
    return false;
  }
</sys:script>


<sys:script type="text/javascript">
$(document).ready(modalUpdate);
function modalUpdate() {
  $('.modal').modal({hide_on_overlay_click:false});
}
</sys:script>



<sys:script type="text/javascript">
$(document).ready(wfUpdate);

function wfUpdate() {
  if($.browser.msie)
  {
  $("area.cluster")
   .click(
     function(){
      $("#JT").remove();
      return false;
     });
  $("area.clusterOption")
   .click(
     function(){
      $("#JT").remove();
      processComponents(this.id);
      return false;
    });
  }else{
  $("area.cluster")
   .click(
     function(){
      $("#JT").remove();
      $("#modal_content").append('Currently processing '+this.alt+'<div><img src="/include/img/ajax-loader.gif"></div>');
      $(".modal_close").remove();
var reload = "/PipelineBuilder/EditWorkflow?pipeline_builder=<% $pipeline_builder %>&cluster="+this.id;
setTimeout(function() {window.location=reload;}, 1000);
      return false;
     });
  $("area.clusterOption")
   .click(
     function(){
      $("#JT").remove();
      processComponents(this.id);
      return false;
    });
  }
}

</sys:script>
